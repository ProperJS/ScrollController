/*!
 *
 * Window scroll event controller
 *
 * @ScrollController
 * @author: kitajchuk
 *
 *
 */
(function ( factory ) {
    
    if ( typeof exports === "object" && typeof module !== "undefined" ) {
        module.exports = factory();

    } else if ( typeof window !== "undefined" ) {
        window.ScrollController = factory();
    }
    
})(function () {

    var Controller = require( "properjs-controller" ),
        
        // Current scroll position
        _currentY = null,
    
        // Singleton
        _instance = null;
    
    /**
     *
     * Window scroll event controller
     * @constructor ScrollController
     * @augments Controller
     * @requires Controller
     * @memberof! <global>
     *
     * @fires scroll
     * @fires scrolldown
     * @fires scrollup
     * @fires scrollmax
     * @fires scrollmin
     *
     */
    var ScrollController = function () {
        // Singleton
        if ( !_instance ) {
            _instance = this;
    
            // Call on parent cycle
            this.go(function () {
                var currentY = _instance.getScrollY(),
                    isStill = (currentY === _currentY),
                    isScroll = (currentY !== _currentY),
                    isScrollUp = (currentY < _currentY),
                    isScrollDown = (currentY > _currentY),
                    isScrollMax = (currentY !== _currentY && _instance.isScrollMax()),
                    isScrollMin = (currentY !== _currentY && _instance.isScrollMin());
    
                // Fire blanket scroll event
                if ( isScroll ) {
                    /**
                     *
                     * @event scroll
                     *
                     */
                    _instance.fire( "scroll" );
                }
    
                // Fire scrollup and scrolldown
                if ( isScrollDown ) {
                    /**
                     *
                     * @event scrolldown
                     *
                     */
                    _instance.fire( "scrolldown" );
    
                } else if ( isScrollUp ) {
                    /**
                     *
                     * @event scrollup
                     *
                     */
                    _instance.fire( "scrollup" );
                }
    
                // Fire scrollmax and scrollmin
                if ( isScrollMax ) {
                    /**
                     *
                     * @event scrollmax
                     *
                     */
                    _instance.fire( "scrollmax" );
    
                } else if ( isScrollMin ) {
                    /**
                     *
                     * @event scrollmin
                     *
                     */
                    _instance.fire( "scrollmin" );
                }
    
                _currentY = currentY;
            });
        }
    
        return _instance;
    };
    
    ScrollController.prototype = new Controller();
    
    /**
     *
     * Returns the current window vertical scroll position
     * @memberof ScrollController
     * @method getScrollY
     * @returns number
     *
     */
    ScrollController.prototype.getScrollY = function () {
        return (window.scrollY || document.documentElement.scrollTop);
    };
    
    /**
     *
     * Get the max document scrollable height
     * @memberof ScrollController
     * @method getScrollMax
     * @returns number
     *
     */
    ScrollController.prototype.getScrollMax = function () {
        return (document.documentElement.offsetHeight - window.innerHeight);
    };
    
    /**
     *
     * Determines if scroll position is at maximum for document
     * @memberof ScrollController
     * @method isScrollMax
     * @returns boolean
     *
     */
    ScrollController.prototype.isScrollMax = function () {
        return (this.getScrollY() >= (document.documentElement.offsetHeight - window.innerHeight));
    };
    
    /**
     *
     * Determines if scroll position is at minimum for document
     * @memberof ScrollController
     * @method isScrollMin
     * @returns boolean
     *
     */
    ScrollController.prototype.isScrollMin = function () {
        return (this.getScrollY() <= 0);
    };
    
    
    return ScrollController;

});